{% extends 'core/base.html' %}

{% block content %}
<div class="header-actions">
    <div>
        <h1>Dashboard</h1>
        <p style="color: var(--text-secondary)">Overview of your plant assets</p>
    </div>
    <a href="{% url 'request_create' %}" class="btn btn-primary">
        <i class="fa-solid fa-plus"></i> New Request
    </a>
</div>

<!-- Search Bar Placeholder as per wireframe -->
<div class="card" style="margin-bottom: 2rem; padding: 0.75rem;">
    <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-secondary);">
        <i class="fa-solid fa-search"></i>
        <input type="text" placeholder="Search..."
            style="border: none; background: transparent; padding: 0; margin: 0; width: 100%;">
    </div>
</div>

<div class="grid grid-cols-3">
    <!-- Critical Equipment Card -->
    <div class="card" style="background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.3);">
        <div style="text-align: center;">
            <div style="color: var(--danger); font-weight: 600; margin-bottom: 0.5rem;">Critical Equipment</div>
            <div style="font-size: 2.5rem; font-weight: 700; color: var(--danger);">{{ critical_count }} Units</div>
            <div style="color: var(--danger); font-size: 0.875rem;">(Health < 30%)</div>
            </div>
        </div>

        <!-- Technician Load Card -->
        <div class="card" style="background: rgba(59, 130, 246, 0.1); border-color: rgba(59, 130, 246, 0.3);">
            <div style="text-align: center;">
                <div style="color: #60a5fa; font-weight: 600; margin-bottom: 0.5rem;">Technician Load</div>
                <div style="font-size: 2.5rem; font-weight: 700; color: #60a5fa;">{{ tech_utilization }}% Utilized</div>
                <div style="color: #60a5fa; font-size: 0.875rem;">(Assign Carefully)</div>
            </div>
        </div>

        <!-- Open Requests Card -->
        <div class="card" style="background: rgba(16, 185, 129, 0.1); border-color: rgba(16, 185, 129, 0.3);">
            <div style="text-align: center;">
                <div style="color: var(--success); font-weight: 600; margin-bottom: 0.5rem;">Open Requests</div>
                <div style="font-size: 2.5rem; font-weight: 700; color: var(--success);">{{ pending_count }} Pending
                </div>
                <div style="color: var(--success); font-weight: 600;">{{ overdue_count }} Overdue</div>
            </div>
        </div>
    </div>

    <!-- Activity Table -->
    <div style="margin-top: 2rem;">
        <div class="card">
            <table>
                <thead>
                    <tr>
                        <th>Subject</th>
                        <th>Date</th>
                        <th>Assigned To</th>
                        <th>Category</th>
                        <th>Stage</th>
                    </tr>
                </thead>
                <tbody>
                    {% for req in recent_activity %}
                    <tr>
                        <td>
                            <div style="font-weight: 500;">{{ req.subject }}</div>
                            <div style="font-size: 0.75rem; color: var(--text-secondary);">{{ req.equipment.name }}
                            </div>
                        </td>
                        <td>{{ req.updated_at|date:"M d, H:i" }}</td>
                        <td>
                            {% if req.assigned_to %}
                            {{ req.assigned_to }}
                            {% else %}
                            <span style="color: var(--text-secondary);">Unassigned</span>
                            {% endif %}
                        </td>
                        <td>{{ req.equipment.category }}</td>
                        <td>
                            <span class="badge 
                            {% if req.stage == 'New' %}badge-new
                            {% elif req.stage == 'In Progress' %}badge-progress
                            {% elif req.stage == 'Repaired' %}badge-repaired
                            {% else %}badge-scrap{% endif %}">
                                {{ req.stage }}
                            </span>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" style="text-align: center; color: var(--text-secondary);">No recent activity.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endblock %}